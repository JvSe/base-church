# üìã INVENT√ÅRIO DE DUPLICA√á√ïES - PASTA COURSES

**Data:** 14/10/2025  
**Escopo:** `/apps/sendo-base/src/app/(private)/dashboard/courses/`  
**Status:** üîç An√°lise Completa Finalizada

---

## üéØ RESUMO EXECUTIVO

### Estat√≠sticas Gerais

- **Arquivos Analisados:** 13 arquivos
- **Linhas de C√≥digo Total:** ~3,700 linhas
- **Duplica√ß√µes Cr√≠ticas Identificadas:** 18 padr√µes
- **Potencial de Redu√ß√£o:** ~40-50% (estimado ~1,500 linhas)
- **Componentes a Criar/Unificar:** 12

---

## üìä MAPA DE DUPLICA√á√ïES

### N√çVEL 1: DUPLICA√á√ÉO CR√çTICA (Alta Prioridade)

#### 1.1 **SCHEMAS DE VALIDA√á√ÉO DUPLICADOS**

**Problema:** Schemas id√™nticos duplicados em 2 arquivos

**Locais:**

- ‚úÖ `create/page.tsx` (linhas 51-91)
- ‚úÖ `[courseId]/edit/page.tsx` (linhas 62-101)

**Duplica√ß√£o:**

```typescript
// courseSchema - 100% ID√äNTICO
const courseSchema = z.object({
  title: z.string().min(1, "T√≠tulo √© obrigat√≥rio")...
});

// moduleSchema - 100% ID√äNTICO
const moduleSchema = z.object({
  title: z.string().min(1, "T√≠tulo do m√≥dulo √© obrigat√≥rio")...
});

// lessonSchema - DIFEREN√áA M√çNIMA (apenas enum values)
const lessonSchema = z.object({
  // create: usa ["video", "text", "objective_quiz", "subjective_quiz"]
  // edit: usa ["VIDEO", "TEXT", "OBJECTIVE_QUIZ", "SUBJECTIVE_QUIZ"]
});

// certificateTemplateSchema - 100% ID√äNTICO
const certificateTemplateSchema = z.object({...});
```

**Oportunidade:**

- **Arquivo:** `lib/forms/course-schemas.ts`
- **Redu√ß√£o:** ~120 linhas eliminadas
- **Benef√≠cio:** Valida√ß√µes consistentes em todo o projeto

---

#### 1.2 **INTERFACES/TYPES DUPLICADAS**

**Problema:** Interfaces duplicadas em m√∫ltiplos arquivos

**Locais:**

- `create/page.tsx` (linhas 98-135)
- `[courseId]/edit/page.tsx` (linhas 108-145)
- `components/lesson-form.tsx` (linhas 37-52)
- `components/question-form.tsx` (linhas 28-43)
- `components/question-list.tsx` (linhas 12-27)

**Duplica√ß√£o:**

```typescript
// Interface Module - Duplicada 2x
interface Module {
  id?: string;
  title: string;
  description: string;
  order: number;
  lessons: Lesson[];
}

// Interface Question - Duplicada 4x
interface Question {
  id?: string;
  questionText: string;
  points: number;
  order: number;
  explanation?: string;
  type: "objective" | "subjective";
  // ...
}

// Interface Lesson - Duplicada 3x (com pequenas varia√ß√µes)
interface Lesson {
  id?: string;
  title: string;
  // ...
}
```

**Oportunidade:**

- **Arquivo:** `lib/types/course.types.ts`
- **Redu√ß√£o:** ~80 linhas eliminadas
- **Benef√≠cio:** Type safety centralizado

---

#### 1.3 **FUN√á√ïES UTILIT√ÅRIAS DUPLICADAS**

**Problema:** Fun√ß√µes id√™nticas repetidas em m√∫ltiplos arquivos

**Locais:**

- `create/page.tsx` (linhas 512-539)
- `[courseId]/edit/page.tsx` (linhas 729-757)

**Duplica√ß√£o:**

```typescript
// 100% ID√äNTICO
const getLessonTypeIcon = (type: string) => {
  switch (type) {
    case "video": return Play;
    // ...
  }
}

// 100% ID√äNTICO
const getLessonTypeText = (type: string) => {
  switch (type) {
    case "video": return "V√≠deo";
    // ...
  }
}

// DUPLICADO - components/courses-list-client.tsx
const getStatusColor = (status: CourseStatus) => {...}
const getStatusText = (status: CourseStatus) => {...}
const getStatusIcon = (status: CourseStatus) => {...}
const formatDuration = (minutes: number) => {...}
```

**Oportunidade:**

- **Arquivo:** `lib/helpers/course.helper.ts`
- **Redu√ß√£o:** ~60 linhas eliminadas
- **Benef√≠cio:** Formatadores centralizados

---

#### 1.4 **L√ìGICA DE GERENCIAMENTO DE ESTADO DUPLICADA**

**Problema:** L√≥gica id√™ntica de manipula√ß√£o de m√≥dulos/li√ß√µes

**Locais:**

- `create/page.tsx` (linhas 137-510)
- `[courseId]/edit/page.tsx` (linhas 154-635)

**Duplica√ß√£o:**

```typescript
// Estados duplicados
const [modules, setModules] = useState<Module[]>([]);
const [showModuleForm, setShowModuleForm] = useState(false);
const [editingModule, setEditingModule] = useState<number | null>(null);
const [showLessonForm, setShowLessonForm] = useState<number | null>(null);
const [editingLesson, setEditingLesson] = useState<{...} | null>(null);
const [showQuestionForm, setShowQuestionForm] = useState<{...} | null>(null);
// + 6 estados adicionais

// Handlers duplicados (~400 linhas)
const handleAddModule = async (data) => {...}
const handleEditModule = (moduleIndex) => {...}
const handleSaveModuleEdit = async (data, moduleIndex) => {...}
const handleAddLesson = async (data, moduleIndex) => {...}
const handleEditLesson = (moduleIndex, lessonIndex) => {...}
const handleSaveLessonEdit = async (data, ...) => {...}
const handleCreateCertificateTemplate = async (data) => {...}
const convertFileToBase64 = (file: File) => {...}
```

**Oportunidade:**

- **Hooks:** `use-course-modules.ts`, `use-course-lessons.ts`
- **Redu√ß√£o:** ~500 linhas eliminadas
- **Benef√≠cio:** L√≥gica reutiliz√°vel e test√°vel

---

### N√çVEL 2: DUPLICA√á√ÉO MODERADA (M√©dia Prioridade)

#### 2.1 **COMPONENTES ACCORDION DUPLICADOS**

**Problema:** Estrutura de Accordion quase id√™ntica para M√≥dulos e Li√ß√µes

**Locais:**

- `create/page.tsx` (linhas 596-1082)
- `[courseId]/edit/page.tsx` (linhas 877-1343)

**Semelhan√ßas:**

- Mesma estrutura de Accordion aninhado
- Mesmos estilos e classes CSS
- Mesma l√≥gica de abrir/fechar
- Mesmos bot√µes de a√ß√£o (Adicionar, Editar, Excluir)

**Diferen√ßas:**

- create: usa √≠ndice local, edit: usa IDs do banco
- edit: tem handlers de delete com API calls

**Oportunidade:**

- **Componentes:** `ModuleAccordion.tsx`, `LessonAccordion.tsx`
- **Redu√ß√£o:** ~300 linhas eliminadas
- **Benef√≠cio:** UI consistente e manuten√≠vel

---

#### 2.2 **ESTADOS DE LOADING/ERROR DUPLICADOS**

**Problema:** C√≥digo de loading state duplicado

**Locais:**

- `page.tsx` (linhas 33-56) - Error state
- `[courseId]/edit/page.tsx` (linhas 760-811) - Loading + Error states

**Duplica√ß√£o:**

```tsx
// Loading State
<div className="dark-bg-primary min-h-screen pb-20">
  <div className="fixed inset-0 opacity-3">...</div>
  <div className="dark-glass dark-shadow-md rounded-2xl p-8 text-center">
    <div className="dark-bg-secondary mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full">
      <BookOpen className="dark-text-tertiary" size={32} />
    </div>
    <h1 className="dark-text-primary mb-2 text-2xl font-bold">
      Carregando curso...
    </h1>
    // ...
  </div>
</div>

// Error State - Estrutura 95% similar
```

**Oportunidade:**

- **Componente:** J√° existe `loading-state.tsx` e `error-state.tsx` em `common/feedback/`
- **A√ß√£o:** Substituir c√≥digo inline por componentes existentes
- **Redu√ß√£o:** ~100 linhas eliminadas

---

#### 2.3 **CARD STATS DUPLICADO**

**Problema:** Cards de estat√≠sticas na p√°gina principal

**Locais:**

- `page.tsx` (linhas 118-214)

**Padr√£o:**

```tsx
// 4 cards quase id√™nticos
<div className="dark-card dark-shadow-sm rounded-xl p-6">
  <div className="flex items-center justify-between">
    <div>
      <p className="dark-text-tertiary text-sm font-medium">Total de Cursos</p>
      <p className="dark-text-primary text-2xl font-bold">{totalCourses}</p>
    </div>
    <div className="dark-primary-subtle-bg rounded-xl p-3">
      <BookOpen className="dark-primary" size={24} />
    </div>
  </div>
  // ...
</div>
```

**Oportunidade:**

- **Componente:** `StatsCard.tsx` ou usar componente gen√©rico `MetricCard`
- **Redu√ß√£o:** ~80 linhas eliminadas

---

### N√çVEL 3: DUPLICA√á√ÉO LEVE (Baixa Prioridade)

#### 3.1 **FORMUL√ÅRIOS SIMILARES**

**Problema:** Estrutura de formul√°rios repetida

**Locais:**

- `components/course-info-form.tsx` (300 linhas)
- `components/module-form.tsx` (95 linhas)
- `components/lesson-form.tsx` (386 linhas)
- `components/certificate-form.tsx` (204 linhas)

**Semelhan√ßas:**

- Mesma estrutura de Form wrapper
- Mesmos FormFields
- Mesmos bot√µes de a√ß√£o (Cancelar/Salvar)
- Mesmos estilos

**Oportunidade:**

- J√° existe `FormSection` utilizado
- Poss√≠vel criar `FormActions` para bot√µes padronizados
- **Redu√ß√£o:** ~40 linhas eliminadas

---

#### 3.2 **CONVERS√ÉO DE TIPOS DUPLICADA**

**Problema:** L√≥gica de convers√£o de enums

**Locais:**

- `create/page.tsx` (linhas 376-382)
- Outros lugares fazem cast direto

**Duplica√ß√£o:**

```typescript
// Mapear tipos para o formato do banco
let lessonType: "VIDEO" | "TEXT" | "OBJECTIVE_QUIZ" | "SUBJECTIVE_QUIZ" =
  "VIDEO";
if (data.type === "video") lessonType = "VIDEO";
else if (data.type === "text") lessonType = "TEXT";
// ...
```

**Oportunidade:**

- **Helper:** `mapLessonTypeToDb()`, `mapLessonTypeFromDb()`
- **Redu√ß√£o:** ~20 linhas eliminadas

---

#### 3.3 **BACKGROUND PATTERN DUPLICADO**

**Problema:** Background pattern repetido

**Status:** ‚úÖ J√Å RESOLVIDO via `PageLayout` component

- Usado em `create/page.tsx` e `[courseId]/edit/page.tsx`

---

## üîß PROBLEMAS ADICIONAIS IDENTIFICADOS

### 4.1 **INCONSIST√äNCIAS DE NOMENCLATURA**

**Problema:** Enums com nomenclaturas diferentes

```typescript
// create/page.tsx usa lowercase
type: z.enum(["video", "text", "objective_quiz", "subjective_quiz"]);

// [courseId]/edit/page.tsx usa UPPERCASE
type: z.enum(["VIDEO", "TEXT", "OBJECTIVE_QUIZ", "SUBJECTIVE_QUIZ"]);

// lesson-form.tsx usa UPPERCASE no select mas lowercase no watcher
```

**Impacto:** Confus√£o e poss√≠veis bugs

---

### 4.2 **L√ìGICA DE QUEST√ïES DUPLICADA**

**Problema:** C√≥digo de cria√ß√£o de quest√µes quase id√™ntico

**Locais:**

- `create/page.tsx` (linhas 935-1035)
- `[courseId]/edit/page.tsx` (linhas 1206-1296)

**Oportunidade:**

- Extrair para fun√ß√£o helper
- **Redu√ß√£o:** ~90 linhas eliminadas

---

### 4.3 **GEST√ÉO DE ACORDE√ïES COMPLEXA**

**Problema:** Estados complexos de acorde√µes abertos

```typescript
const [openModules, setOpenModules] = useState<string[]>([]);
const [openLessons, setOpenLessons] = useState<string[]>([]);
// L√≥gica complexa de gerenciamento
```

**Oportunidade:**

- Hook `useAccordionState`

---

## üìà M√âTRICAS DE IMPACTO

### Redu√ß√£o de C√≥digo Estimada

| Categoria       | Linhas Antes | Linhas Depois | Economia |
| --------------- | ------------ | ------------- | -------- |
| Schemas         | 240          | 120           | **50%**  |
| Types           | 120          | 40            | **67%**  |
| Helpers         | 120          | 30            | **75%**  |
| Estado/Handlers | 1000         | 500           | **50%**  |
| Acorde√µes       | 600          | 300           | **50%**  |
| Loading/Error   | 150          | 50            | **67%**  |
| Stats Cards     | 96           | 16            | **83%**  |
| **TOTAL**       | **~2,326**   | **~1,056**    | **~55%** |

### Benef√≠cios Qualitativos

‚úÖ **Manutenibilidade:** Altera√ß√µes em 1 lugar propagam para todos os usos  
‚úÖ **Consist√™ncia:** Comportamento uniforme em todo o sistema  
‚úÖ **Testabilidade:** Componentes/hooks isolados mais f√°ceis de testar  
‚úÖ **Type Safety:** Types centralizados evitam inconsist√™ncias  
‚úÖ **Performance:** Menos c√≥digo = bundle menor  
‚úÖ **Developer Experience:** Menos c√≥digo = menos bugs potenciais

---

## üéØ PLANO DE A√á√ÉO PRIORIZADO

### FASE 1: Funda√ß√µes (Alto Impacto, R√°pido)

1. ‚úÖ Criar `lib/forms/course-schemas.ts` com todos os schemas
2. ‚úÖ Criar `lib/types/course.types.ts` com todas as interfaces
3. ‚úÖ Criar `lib/helpers/course.helper.ts` com fun√ß√µes utilit√°rias
4. ‚úÖ Substituir Loading/Error states por componentes existentes

**Estimativa:** 2-3 horas  
**Redu√ß√£o:** ~400 linhas

### FASE 2: Hooks Customizados (Alto Impacto, M√©dio Esfor√ßo)

5. ‚úÖ Criar `hooks/use-course-modules.ts`
6. ‚úÖ Criar `hooks/use-course-lessons.ts`
7. ‚úÖ Criar `hooks/use-course-questions.ts`
8. ‚úÖ Criar `hooks/use-accordion-state.ts`

**Estimativa:** 4-5 horas  
**Redu√ß√£o:** ~600 linhas

### FASE 3: Componentes de UI (M√©dio Impacto, M√©dio Esfor√ßo)

9. ‚úÖ Criar `components/common/data-display/stats-card.tsx`
10. ‚úÖ Criar `components/common/data-display/module-accordion.tsx`
11. ‚úÖ Criar `components/common/data-display/lesson-accordion.tsx`
12. ‚úÖ Refatorar `FormActions` padronizado

**Estimativa:** 3-4 horas  
**Redu√ß√£o:** ~400 linhas

### FASE 4: Migra√ß√£o e Valida√ß√£o

13. ‚úÖ Migrar `create/page.tsx` para usar novos componentes
14. ‚úÖ Migrar `[courseId]/edit/page.tsx` para usar novos componentes
15. ‚úÖ Validar funcionalidades (criar, editar, deletar)
16. ‚úÖ Testes manuais completos
17. ‚úÖ Ajustes finais

**Estimativa:** 3-4 horas

---

## üèóÔ∏è ESTRUTURA DE ARQUIVOS PROPOSTA

```
apps/sendo-base/src/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ forms/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ course-schemas.ts           # ‚ú® NOVO
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ course.types.ts             # ‚ú® NOVO
‚îÇ   ‚îú‚îÄ‚îÄ helpers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ course.helper.ts            # ‚ú® NOVO
‚îÇ   ‚îî‚îÄ‚îÄ hooks/
‚îÇ       ‚îú‚îÄ‚îÄ use-course-modules.ts       # ‚ú® NOVO
‚îÇ       ‚îú‚îÄ‚îÄ use-course-lessons.ts       # ‚ú® NOVO
‚îÇ       ‚îú‚îÄ‚îÄ use-course-questions.ts     # ‚ú® NOVO
‚îÇ       ‚îî‚îÄ‚îÄ use-accordion-state.ts      # ‚ú® NOVO
‚îÇ
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ common/
        ‚îú‚îÄ‚îÄ data-display/
        ‚îÇ   ‚îú‚îÄ‚îÄ stats-card.tsx          # ‚ú® NOVO
        ‚îÇ   ‚îú‚îÄ‚îÄ module-accordion.tsx    # ‚ú® NOVO
        ‚îÇ   ‚îî‚îÄ‚îÄ lesson-accordion.tsx    # ‚ú® NOVO
        ‚îî‚îÄ‚îÄ forms/
            ‚îî‚îÄ‚îÄ form-actions.tsx        # ‚ú® NOVO

# Arquivos Existentes (Refatorar)
apps/sendo-base/src/app/(private)/dashboard/courses/
‚îú‚îÄ‚îÄ page.tsx                            # üîÑ REFATORAR
‚îú‚îÄ‚îÄ create/page.tsx                     # üîÑ REFATORAR
‚îú‚îÄ‚îÄ [courseId]/edit/page.tsx            # üîÑ REFATORAR
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ course-info-form.tsx            # üîÑ AJUSTAR
    ‚îú‚îÄ‚îÄ module-form.tsx                 # ‚úÖ OK (m√≠nimas mudan√ßas)
    ‚îú‚îÄ‚îÄ lesson-form.tsx                 # üîÑ AJUSTAR
    ‚îú‚îÄ‚îÄ certificate-form.tsx            # ‚úÖ OK
    ‚îî‚îÄ‚îÄ ...
```

---

## ‚ö†Ô∏è RISCOS E CONSIDERA√á√ïES

### Riscos T√©cnicos

1. **Breaking Changes:** Mudan√ßas em types podem quebrar c√≥digo dependente
2. **Testes:** Sem testes automatizados, valida√ß√£o manual √© cr√≠tica
3. **Estado Complexo:** L√≥gica de m√≥dulos/li√ß√µes tem interdepend√™ncias

### Mitiga√ß√µes

- ‚úÖ Migra√ß√£o incremental (fase por fase)
- ‚úÖ Git commits frequentes por feature
- ‚úÖ Manter c√≥digo antigo at√© valida√ß√£o completa
- ‚úÖ Checklist de testes manuais detalhado

---

## üìù CHECKLIST DE VALIDA√á√ÉO

Ap√≥s cada fase, validar:

**Funcionalidades de Curso:**

- [ ] Criar curso
- [ ] Editar curso
- [ ] Deletar curso
- [ ] Listar cursos
- [ ] Buscar cursos
- [ ] Ver estat√≠sticas

**Funcionalidades de M√≥dulo:**

- [ ] Adicionar m√≥dulo
- [ ] Editar m√≥dulo
- [ ] Deletar m√≥dulo
- [ ] Reordenar m√≥dulos (se aplic√°vel)

**Funcionalidades de Li√ß√£o:**

- [ ] Adicionar li√ß√£o (V√≠deo)
- [ ] Adicionar li√ß√£o (Texto)
- [ ] Adicionar li√ß√£o (Quiz Objetivo)
- [ ] Adicionar li√ß√£o (Quiz Subjetivo)
- [ ] Editar li√ß√£o
- [ ] Deletar li√ß√£o

**Funcionalidades de Quest√£o:**

- [ ] Adicionar quest√£o objetiva
- [ ] Adicionar quest√£o subjetiva
- [ ] Editar quest√£o
- [ ] Deletar quest√£o
- [ ] Valida√ß√£o de op√ß√µes corretas

**Funcionalidades de Certificado:**

- [ ] Criar template
- [ ] Editar template
- [ ] Upload de PDF
- [ ] Preview de certificado

---

## üéâ CONCLUS√ÉO

O invent√°rio identificou **18 padr√µes de duplica√ß√£o** com potencial de redu√ß√£o de **~55% do c√≥digo** (~1,270 linhas).

A refatora√ß√£o proposta seguir√° os princ√≠pios:

- ‚úÖ **DRY:** Don't Repeat Yourself
- ‚úÖ **SOLID:** Single Responsibility
- ‚úÖ **Composition over Configuration**
- ‚úÖ **Progressive Enhancement:** Migra√ß√£o incremental segura

**Pr√≥ximo Passo:** Iniciar FASE 1 - Criar arquivos de funda√ß√£o (schemas, types, helpers)
